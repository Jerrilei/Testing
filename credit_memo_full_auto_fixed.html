<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Credit Memorandum â€” Final Editor</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f4f7fb;--card:#fff;--muted:#6b7280;--accent:#0b66c3;--danger:#ef4444;--missing-ring:#facc15}
body{font-family:Inter,Arial,sans-serif;background:var(--bg);margin:0;color:#0f172a}
.container{max-width:1200px;margin:0 auto;padding:20px 24px 40px}
.card{background:var(--card);border-radius:12px;padding:18px 20px;margin-bottom:20px;box-shadow:0 4px 18px rgba(15,23,42,0.08);border:1px solid rgba(15,23,42,0.03)}
.section-title{font-size:18px;font-weight:700;margin:4px 0 12px}
label{font-size:13px;color:var(--muted)}
input,textarea,select{width:100%;padding:8px 10px;margin-top:4px;border-radius:8px;border:1px solid #d1d5db;font-size:14px;background:#fff;box-sizing:border-box}
textarea{min-height:80px;resize:vertical}
input.highlight,textarea.highlight{border-color:var(--missing-ring);box-shadow:0 0 0 1px var(--missing-ring)}
.table{width:100%;border-collapse:collapse;margin-top:8px;font-size:14px}
.table th,.table td{padding:8px;border-bottom:1px solid #e5e7eb;vertical-align:top}
.table th{font-weight:600;text-align:left;background:#f9fafb}
.btn{background:var(--accent);color:#fff;padding:8px 18px;border-radius:8px;border:0;cursor:pointer;font-size:14px;font-weight:600;display:inline-flex;align-items:center;gap:6px}
.btn-outline{background:transparent;border:2px solid var(--accent);color:var(--accent);padding:7px 18px;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600}
.btn:disabled,.btn-outline:disabled{opacity:.5;cursor:not-allowed}
.header-row{display:flex;justify-content:space-between;align-items:flex-start;gap:16px}
.header-actions{display:flex;align-items:flex-end;gap:10px}
.buyer-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px}
.field-col{display:flex;flex-direction:column;gap:10px}
.field{display:flex;flex-direction:column}
.note{font-size:12px;color:var(--muted)}
.small{font-size:12px}

/* Obligor Ratings 3-column grid */
.obligor-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px}

/* Floating Chatbot */
#chatFloatBtn{position:fixed;right:24px;bottom:24px;background:#0b66c3;color:#fff;width:54px;height:54px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.25);z-index:999}
#chatPanel{position:fixed;right:24px;bottom:90px;width:320px;background:#fff;border-radius:12px;box-shadow:0 8px 26px rgba(0,0,0,0.2);padding:12px;display:none;z-index:998}
#chatPanel textarea{min-height:70px}
</style>
</head>
<body>
<div class="container">

<!-- HEADER -->
<div class="card">
  <div class="header-row">
    <div>
      <h1 style="margin:0;font-size:22px">CREDIT MEMORANDUM</h1>
      <div class="note">Template aligned to PDF memo. Required fields are ringed in amber until completed.</div>
    </div>
    <div class="header-actions">
      <div style="text-align:right">
        <div class="note">Prepared date</div>
        <div id="prepDate">2025-01-01</div>
      </div>
    </div>
  </div>

  <div style="display:flex;gap:12px;margin-top:14px;align-items:flex-end">
    <div style="flex:1">
      <label>Buyer name</label>
      <input id="buyerLookup" placeholder="Type buyer name (e.g. Walmart)" />
    </div>
    <button class="btn" id="refreshBuyer" disabled>Refresh (coming later)</button>
    <button class="btn-outline" id="prefillWalmartBtn">Demo (PDD)</button>
  </div>

  <div style="margin-top:16px" class="section-title">Executive Summary</div>
  <textarea id="execSummary" data-required="1"></textarea>

  <div style="margin-top:12px" class="section-title">Key Highlights</div>
  <textarea id="highlights"></textarea>
</div>

<!-- BUYER INFORMATION -->
<div class="card">
  <div class="section-title">Buyer Information</div>
  <div class="buyer-grid">
    <!-- Column 1: Basic info -->
    <div class="field-col">
      <div class="field">
        <label>Borrower / Obligor *</label>
        <input id="companyName" data-required="1" />
      </div>
      <div class="field">
        <label>Group / Parent Legal Name</label>
        <input id="groupParentName" />
      </div>
      <div class="field">
        <label>Obligor Legal Name</label>
        <input id="obligorLegalName" />
      </div>
      <div class="field">
        <label>Country</label>
        <input id="country" />
      </div>
      <div class="field">
        <label>Country of Incorporation</label>
        <input id="countryOfIncorp" />
      </div>
    </div>

    <!-- Column 2: Core business -->
    <div class="field-col">
      <div class="field">
        <label>Business description</label>
        <textarea id="business"></textarea>
      </div>
      <div class="field">
        <label>Business activities</label>
        <textarea id="coreBusinessActivities"></textarea>
      </div>
      <div class="field">
        <label>Key Customers</label>
        <textarea id="coreBusinessCustomers"></textarea>
      </div>
      <div class="field">
        <label>Website</label>
        <input id="coreBusinessWebsite" />
      </div>
    </div>

    <!-- Column 3: Ratings / market cap -->
    <div class="field-col">
      <div class="field">
        <label>Market Cap</label>
        <input id="marketCap" />
      </div>
      <div class="field">
        <label>External credit rating</label>
        <input id="externalRating" />
      </div>
      <div class="field">
        <label>Internal Rating (Current)</label>
        <input id="internalRatingCurrent" />
      </div>
      <div class="field">
        <label>Internal Rating (Proposed)</label>
        <input id="internalRatingProposed" />
      </div>
    </div>
  </div>
</div>

<!-- SUMMARY FINANCIALS -->
<div class="card">
  <div class="section-title">Financial Highlights (Summary)</div>
  <table class="table" id="summaryFinTbl">
    <thead>
      <tr><th>Metric</th><th>2022</th><th>2023</th><th>2024</th><th>23 vs 22</th><th>24 vs 23</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- CREDIT LIMITS -->
<div class="card">
  <div class="section-title">Credit Limits</div>
  <table class="table">
    <thead>
      <tr>
        <th>(US$m)</th><th>Existing</th><th>Current utilisation</th><th>Proposed</th>
        <th>Insurer / GMV & insurance</th>
        <th>Financing Terms</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>Secured</th>
        <td><input id="limSecExisting" data-required="1" /></td>
        <td><input id="limSecUtil" data-required="1" /></td>
        <td><input id="limSecProp" data-required="1" /></td>
        <td rowspan="4">
          <div class="small"><strong>Insurer</strong></div>
          <input id="insurer" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Credit Insurance Limit</strong></div>
          <input id="creditInsLimit" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Advance Rate</strong></div>
          <input id="advanceRate" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>TCS Rate</strong></div>
          <input id="tcsRate" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Past 12 mth GMV</strong></div>
          <input id="gmvPast12" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Forecast 12 mth GMV</strong></div>
          <input id="gmvForecast12" data-required="1" />
        </td>
        <td rowspan="4">
          <div class="small"><strong>Financing term</strong></div>
          <input id="financingTerm" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Supplier Credit Days</strong></div>
          <input id="supplierCreditDays" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Payment History / Delay Days</strong></div>
          <input id="paymentHistory" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Dilution rate</strong></div>
          <input id="dilutionRate" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>Peak / Average WC</strong></div>
          <input id="peakAvgWc" data-required="1" />
          <div class="small" style="margin-top:6px"><strong>LF Customer Since</strong></div>
          <input id="customerSince" data-required="1" />
        </td>
      </tr>
      <tr>
        <th>Residual</th>
        <td><input id="limResExisting" data-required="1" /></td>
        <td><input id="limResUtil" data-required="1" /></td>
        <td><input id="limResProp" data-required="1" /></td>
      </tr>
      <tr>
        <th>Clean</th>
        <td><input id="limCleanExisting" data-required="1" /></td>
        <td><input id="limCleanUtil" data-required="1" /></td>
        <td><input id="limCleanProp" data-required="1" /></td>
      </tr>
      <tr>
        <th>Total</th>
        <td><input id="limTotExisting" data-required="1" /></td>
        <td><input id="limTotUtil" data-required="1" /></td>
        <td><input id="limTotProp" data-required="1" /></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- FULL FINANCIALS -->
<div class="card">
  <div class="section-title">Financial Highlights (Full)</div>
  <table class="table" id="finTableFull">
    <thead>
      <tr><th>Metric</th><th>2022</th><th>2023</th><th>2024</th><th>23 vs 22</th><th>24 vs 23</th><th>Latest Quarter</th></tr>
    </thead>
    <tbody id="finBody"></tbody>
  </table>
</div>

<!-- ANALYSIS -->
<div class="card">
  <div class="section-title">Automated Financial Analysis</div>
  <div id="analysisBox" contenteditable="true" style="font-size:14px;line-height:1.5"></div>
  <div class="note" style="margin-top:6px">You can edit the analysis text directly above after the demo prefill.</div>
</div>

<!-- LIQUIDITY -->
<div class="card">
  <div class="section-title">Liquidity Metrics</div>
  <table class="table">
    <tr><th>Metric</th><th>2022</th><th>2023</th><th>2024</th><th>Notes</th></tr>
    <tr>
      <td>Liquidity headroom</td>
      <td><input id="liq22" data-required="1" /></td>
      <td><input id="liq23" data-required="1" /></td>
      <td><input id="liq24" data-required="1" /></td>
      <td><textarea id="liqNotes" data-required="1"></textarea></td>
    </tr>
  </table>
</div>

<!-- OBLIGOR RATINGS (3 columns) -->
<div class="card">
  <div class="section-title">Obligor Ratings</div>
  <div class="obligor-grid">
    <div class="field">
      <label>Internal Score</label>
      <input id="intScore" data-required="1" />
    </div>
    <div class="field">
      <label>External Rating</label>
      <input id="extRating2" data-required="1" />
    </div>
    <div class="field">
      <label>Rationale</label>
      <textarea id="ratingRationale" data-required="1"></textarea>
    </div>
  </div>
</div>

<!-- RECOMMENDATION -->
<div class="card">
  <div class="section-title">Recommendation & Action Plan</div>
  <textarea id="recommend" data-required="1"></textarea>
</div>

<!-- RISKS -->
<div class="card">
  <div class="section-title">Key Risks & Mitigants</div>
  <textarea id="risks" data-required="1"></textarea>
</div>

</div><!-- /container -->

<!-- FLOATING CHATBOT BUTTON -->
<div id="chatFloatBtn" title="Ask about the analysis">ðŸ’¬</div>
<div id="chatPanel">
  <div style="font-weight:600;margin-bottom:6px">Analyst Chatbot</div>
  <div class="note" style="margin-bottom:4px">Quick questions about the financial analysis & sources.</div>
  <textarea id="floatQ" placeholder="e.g. Which 10-K section explains the EBITDA decline?"></textarea>
  <button class="btn" id="floatAsk" style="margin-top:6px;width:100%">Ask</button>
  <div id="floatA" style="margin-top:8px;font-size:13px;color:#374151">â€”</div>
</div>

<script>
// ---- DEMO PREFILL + UI HELPERS ----

document.addEventListener('DOMContentLoaded',()=>{
  // Required field highlighting
  const requiredEls=document.querySelectorAll('[data-required="1"]');
  requiredEls.forEach(el=>{
    const toggle=()=>{
      if((el.value||'').trim()) el.classList.remove('highlight');
      else el.classList.add('highlight');
    };
    toggle();
    el.addEventListener('input',toggle);
  });

  // Demo prefill button
  const demoBtn=document.getElementById('prefillPddBtn');
if(demoBtn){ demoBtn.addEventListener('click', prefillPDD); }

  // Floating chat toggle
  const chatBtn=document.getElementById('chatFloatBtn');
  const chatPanel=document.getElementById('chatPanel');
  if(chatBtn){
    chatBtn.addEventListener('click',()=>{
      chatPanel.style.display=chatPanel.style.display==='block'?'none':'block';
    });
  }

  // Chatbot Q&A
  const qaPairs=[
    {keys:['revenue','sales','top line'],ans:'Revenue growth and mix are discussed in section 2.1 of the Automated Financial Analysis and in Walmart\'s FY2024 Form 10-K MD&A (Net sales and Operating segments).'},
    {keys:['ebitda','operating income','margin'],ans:'Profitability drivers are summarised in section 2.2 and tie to the FY2024 Form 10-K and 2024 Annual Report commentary on gross margin, SG&A and one-off items.'},
    {keys:['cash','debt','bond','maturity'],ans:'Section 2.3 covers cash flow, leverage and the 3.55% notes due June 2025. For detailed numbers see the liquidity and debt notes in the FY2024 Form 10-K and the bond disclosure linked in Sources.'},
    {keys:['store','footprint','remodel','expansion'],ans:'Section 2.4 summarises store footprint and remodel activity using company strategy updates and third-party store statistics.'},
    {keys:['risk','tariff','fx','foreign exchange','macro'],ans:'Key macro and business risks (tariffs, FX, competition) and mitigants are captured in the Key Risks & Mitigants card. They align with Walmart\'s Risk Factors and MD&A sections.'}
  ];

  const askBtn=document.getElementById('floatAsk');
  const qBox=document.getElementById('floatQ');
  const aBox=document.getElementById('floatA');
  if(askBtn){
    askBtn.addEventListener('click',()=>{
      const q=(qBox.value||'').toLowerCase();
      if(!q){aBox.textContent='Please type a question first.';return;}
      let ans='I do not have a specific prepared answer for that question. Please refer to the Automated Financial Analysis and linked sources.';
      for(const p of qaPairs){ if(p.keys.some(k=>q.includes(k))){ ans=p.ans; break; } }
      aBox.textContent=ans;
    });
  }
});

// PDD Holdings Demo Prefill
function prefillPDD(){
  const d = {
    buyerLookup: "PDD Holdings Inc.",
    companyName: "PDD Holdings Inc.",
    groupParentName: "PDD Holdings Inc.",
    obligorLegalName: "PDD Holdings Inc.",
    country: "China",
    countryOfIncorp: "Cayman Islands",
    business: "China-based e-commerce holding company operating Pinduoduo and the global cross-border platform Temu.",
    coreBusinessActivities: "Online marketplace and value-for-money e-commerce focused on agricultural produce, general merchandise and cross-border consumer products.",
    coreBusinessCustomers: "China, United States, key European markets",
    coreBusinessWebsite: "https://investor.pddholdings.com",
    marketCap: "~US$150bn+",
    externalRating: "Not publicly rated",
    internalRatingCurrent: "B(60)",
    internalRatingProposed: "B(60)",

    summary: {
      "Revenue (RMB m)": {22: 130558, 23: 247639, 24: 393836},
      "Operating income (RMB m)": {22: 36264, 23: 71876, 24: 132701},
      "Net income (RMB m)": {22: 31538, 23: 60027, 24: 112435}
    },

    full: {
      Revenue: {22:130558,23:247639,24:393836,q:"~RMB108bn latest quarter"},
      GrossProfit:{22:99095,23:155916,24:239936,q:"â€”"},
      EBITDA:{22:36264,23:71876,24:132701,q:"â€”"},
      NetIncome:{22:31538,23:60027,24:112435,q:"â€”"},
      CashBank:{22:60000,23:75000,24:90000,q:"strong net cash"},
      Inventory:{22:10000,23:12000,24:15000,q:"asset-light"},
      TotalDebt:{22:15000,23:18000,24:20000,q:"no major maturities"},
      Equity:{22:90000,23:120000,24:160000,q:"â€”"},
      FreeCashFlow:{22:25000,23:30000,24:40000,q:"growing"}
    },

    recommend:
`Business strength & sustainability
- PDD operates a scalable, data-driven e-commerce ecosystem (Pinduoduo + Temu) with strong competitive positioning.

Financial standing
- FY2024 results show rapid revenue growth, strong profitability and a solid net cash position.

Prospects & tariff impact
- Growth expected to continue, though tariff and regulatory changes (especially in the US) could pressure Temu margins.

Payment behavior
- Payment performance through LF flows is satisfactory.

Action plans
1. Quarterly monitoring (financials, Temu updates, tariffs).
2. Annual deep-dive analysis.`,

    risks:
`Source of repayment
- Free cash flow from Pinduoduo & Temu, strong net cash.

Declining performance
- Risk from competition, regulation. Mitigated by flexible marketing spending.

Refinancing risk
- No major maturities; strong cash provides buffer.

Tariff risk
- Temu exposed to US tariff changes. Mitigations include pricing, sourcing diversification, and logistics adjustments.`,

    analysisHtml: `
      <h4>3.1 Revenue & profitability</h4>
      <ul>
        <li><strong>Rapid top-line growth:</strong> Revenue grew from RMB131bn â†’ RMB394bn in 3 years, driven by Pinduoduo + Temu expansion.</li>
        <li><strong>Strong profitability:</strong> Operating profit more than tripled; margins benefited from scale and disciplined spending.</li>
        <li><strong>Volatility:</strong> Quarterly margins fluctuate due to Temu investment and marketing cycles.</li>
        <li><strong>Outlook:</strong> Continued growth but slower; tariffs and overseas policies are key variables.</li>
      </ul>
      <h4>3.2 Balance sheet & capital structure</h4>
      <ul>
        <li><strong>Net cash:</strong> Strong liquidity, asset-light model.</li>
        <li><strong>Low refinancing risk:</strong> No major near-term maturities.</li>
      </ul>
      <h4>3.3 Cash flow & working capital</h4>
      <ul>
        <li><strong>Free cash flow strong and rising</strong> due to platform economics.</li>
        <li><strong>Working capital efficient</strong> given merchant settlement model.</li>
      </ul>
    `
  };

  // ---- apply to page ----
  for (const k in d){
    if (typeof d[k]==="string"){
      const el=document.getElementById(k);
      if(el){
        el.value=d[k];
        el.dispatchEvent(new Event('input'));
      }
    }
  }

  // Summary table
  const sumBody=document.querySelector('#summaryFinTbl tbody');
  sumBody.innerHTML='';
  for (const k in d.summary){
    const r=d.summary[k];
    const tr=document.createElement('tr');
    const yoy23=((r[23]-r[22])/r[22]*100).toFixed(1)+"%";
    const yoy24=((r[24]-r[23])/r[23]*100).toFixed(1)+"%";
    tr.innerHTML=`<td>${k}</td>
      <td>${r[22].toLocaleString()}</td>
      <td>${r[23].toLocaleString()}</td>
      <td>${r[24].toLocaleString()}</td>
      <td>${yoy23}</td>
      <td>${yoy24}</td>`;
    sumBody.appendChild(tr);
  }

  // Full table
  const fullBody=document.getElementById('finBody');
  fullBody.innerHTML='';
  for (const key in d.full){
    const r=d.full[key];
    const label=key.replace(/([A-Z])/g," $1").trim();
    const yoy23=((r[23]-r[22])/r[22]*100).toFixed(1)+"%";
    const yoy24=((r[24]-r[23])/r[23]*100).toFixed(1)+"%";
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${label}</td>
      <td>${r[22].toLocaleString()}</td>
      <td>${r[23].toLocaleString()}</td>
      <td>${r[24].toLocaleString()}</td>
      <td>${yoy23}</td>
      <td>${yoy24}</td>
      <td>${r.q}</td>`;
    fullBody.appendChild(tr);
  }

  document.getElementById('liqNotes').value =
    'Net cash + asset-light model â†’ comfortable liquidity headroom.';
  document.getElementById('liqNotes').dispatchEvent(new Event('input'));

  document.getElementById('recommend').value=d.recommend;
  document.getElementById('recommend').dispatchEvent(new Event('input'));

  document.getElementById('risks').value=d.risks;
  document.getElementById('risks').dispatchEvent(new Event('input'));

  document.getElementById('analysisBox').innerHTML=d.analysisHtml;
}

